# Generated with protoc-gen-openapi
# https://github.com/google/gnostic/tree/master/cmd/protoc-gen-openapi

openapi: 3.0.3
info:
    title: ""
    version: 0.0.1
paths:
    /v1/messengers/webhook/api/{webhookSecret}:
        post:
            tags:
                - APIWebhookService
            description: |-
                HandleIncoming processes incoming messages from external systems.
                 Returns acknowledgment with internal message ID.
            operationId: APIWebhookService_HandleIncoming
            parameters:
                - name: webhookSecret
                  in: path
                  description: Webhook secret from URL path (used for routing and validation).
                  required: true
                  schema:
                    type: string
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/messengers.v1.APIIncomingRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/messengers.v1.APIIncomingResponse'
    /v1/messengers/webhook/api/{webhookSecret}/poll:
        get:
            tags:
                - APIWebhookService
            description: |-
                Poll long-polls for outgoing messages (agent responses).
                 Used when webhook_url is not configured (e.g. localhost development).
                 The request holds open until new messages arrive or timeout expires.
            operationId: APIWebhookService_Poll
            parameters:
                - name: webhookSecret
                  in: path
                  description: Webhook secret from URL path (identifies the channel config).
                  required: true
                  schema:
                    type: string
                - name: lastId
                  in: query
                  description: |-
                    Optional UUID of the last received message.
                     Only messages created after this one will be returned.
                  schema:
                    type: string
                - name: timeout
                  in: query
                  description: Timeout in seconds to wait for new messages (default 25, max 60).
                  schema:
                    type: integer
                    format: int32
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/messengers.v1.APIPollResponse'
    /v1/messengers/webhook/vk/{webhookSecret}:
        post:
            tags:
                - VKWebhookService
            description: |-
                HandleCallback processes VK Callback API events.
                 Returns plain text response ("ok" or confirmation token).
            operationId: VKWebhookService_HandleCallback
            parameters:
                - name: webhookSecret
                  in: path
                  description: Webhook secret extracted from URL path.
                  required: true
                  schema:
                    type: string
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/messengers.v1.VKCallbackRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        '*/*': {}
components:
    schemas:
        messengers.v1.APIAttachment:
            type: object
            properties:
                type:
                    type: string
                    description: 'Attachment type: photo, document, audio, video.'
                url:
                    type: string
                    description: Direct URL to the file.
                fileName:
                    type: string
                    description: Optional original file name.
                mimeType:
                    type: string
                    description: Optional MIME type.
                size:
                    type: string
                    description: Optional file size in bytes.
            description: APIAttachment represents an attachment in the incoming message.
        messengers.v1.APIIncomingRequest:
            type: object
            properties:
                webhookSecret:
                    type: string
                    description: Webhook secret from URL path (used for routing and validation).
                messageId:
                    type: string
                    description: |-
                        Unique message ID from external system (for idempotency).
                         If not provided, will be auto-generated.
                chatId:
                    type: string
                    description: External chat/conversation identifier.
                userId:
                    type: string
                    description: External user identifier.
                content:
                    type: string
                    description: Message text content.
                userName:
                    type: string
                    description: Optional user display name.
                userAvatarUrl:
                    type: string
                    description: Optional user avatar URL.
                attachments:
                    type: array
                    items:
                        $ref: '#/components/schemas/messengers.v1.APIAttachment'
                    description: Optional attachments.
                metadata:
                    type: object
                    description: Optional metadata (passed through to agent).
                timestamp:
                    type: string
                    description: Optional timestamp in RFC3339 format.
            description: APIIncomingRequest represents incoming webhook from external system.
        messengers.v1.APIIncomingResponse:
            type: object
            properties:
                status:
                    type: string
                    description: 'Status: "ok" or "error".'
                messageId:
                    type: string
                    description: Internal message ID (UUID).
                chatId:
                    type: string
                    description: Internal chat ID.
                error:
                    type: string
                    description: Error message if status is "error".
            description: APIIncomingResponse is returned to acknowledge message receipt.
        messengers.v1.APIPollMessage:
            type: object
            properties:
                id:
                    type: string
                    description: Internal message UUID.
                content:
                    type: string
                    description: Message text content.
                chatId:
                    type: string
                    description: External chat/conversation identifier.
                userId:
                    type: string
                    description: External user identifier.
                agentRunId:
                    type: string
                    description: Agent run UUID that generated this message.
                timestamp:
                    type: string
                    description: Timestamp in RFC3339 format.
                metadata:
                    type: object
                    description: Optional metadata from the agent.
            description: APIPollMessage represents a single outgoing message from the agent.
        messengers.v1.APIPollResponse:
            type: object
            properties:
                messages:
                    type: array
                    items:
                        $ref: '#/components/schemas/messengers.v1.APIPollMessage'
                    description: List of outgoing messages (agent responses).
            description: APIPollResponse contains outgoing messages collected during the poll.
        messengers.v1.VKCallbackRequest:
            type: object
            properties:
                webhookSecret:
                    type: string
                    description: Webhook secret extracted from URL path.
                type:
                    type: string
                    description: 'VK Callback fields (from JSON body):'
                object:
                    type: object
                groupId:
                    type: string
                eventId:
                    type: string
                secret:
                    type: string
                v:
                    type: string
            description: |-
                VKCallbackRequest represents incoming VK Callback API request.
                 Fields are flat for direct JSON mapping from VK webhook payload.
tags:
    - name: APIWebhookService
      description: |-
        APIWebhookService handles incoming webhooks for API channel integrations.
         This service enables integration with any messenger through middleware
         platforms like n8n, Make, or custom integrations.
    - name: VKWebhookService
      description: VKWebhookService handles VK Callback API webhooks.
