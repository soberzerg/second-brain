# **Clario Data Architecture Vision**

## **Canonical Data Model для продукта и платформы**

## 1\. Purpose

Создать единый продуктово-технический фундамент, на который опираются все модули Clario: аналитика, агенты, подсказки, отчеты, RAG, интеграции и будущие сервисы. Цель — обеспечить масштабируемость, независимость от CRM, точность анализа и возможность развивать систему в сторону полноценной Revenue Intelligence платформы.

## 2\. Vision: Clario как Revenue Intelligence System

Clario — это не интерфейс к CRM и не набор AI-фич.

Clario — это система, которая анализирует все события, влияющие на выручку компании, и превращает их в actionable-инсайты, подсказки и автоматизацию:

1. **Агрегирует** все коммуникации и события (Data Ingestion).

2. **Нормализует** их в универсальную модель (Canonical Model).

3. **Адаптирует** аналитические пайплайны под профиль клиента (Adaptive Intelligence).

Ценность растет со временем, так как система накапливает не просто данные, а *знания* о том, какие паттерны продаж работают для конкретных типов бизнеса.

## 3\. The Three-Layer Canonical Data Model

Чтобы избежать зависимости от специфики CRM и хаоса в данных, мы внедряем строгую трехуровневую модель абстракций:

### **Level 1: Atomic Interactions (The "Physics") — *Immutable***

Нижний уровень. Это "физика" мира продаж — факты, которые произошли в реальности. Они неизменны и не зависят от того, заведена ли сделка в CRM.

* **MessageEvent** (Email, Chat, SMS) — факт отправки/получения.

* **CallEvent** (Voice) — факт звонка \+ транскрипция \+ метаданные.

* **MeetingEvent** (Calendar) — факт встречи.

* **Принцип:** Single Source of Truth. Мы храним их вечно в "сыром" и нормализованном виде.

  ### **Level 2: Business Contexts (The "Rules") — *Mutable Aggregates***

Средний уровень. Это абстракция над сущностями CRM (Lead, Deal, Opportunity, Smart Process). Мы вводим своё определение **"Canonical Deal"**.

* **Clario Deal (Context)** — универсальный контейнер, объединяющий серию *Atomic Interactions* с целью получения выручки.

* **Clario Tenant** — компания-клиент.

* **Clario Actor** — менеджер или агент.

* **Принцип:** Мы не зеркалируем 100 полей из внешней CRM. Мы маппим внешний объект на наш `Clario Deal` (ID, Status, Value, Responsible). Это позволяет нам работать, даже если клиент сменит CRM.

  ### **Level 3: Analytical Intelligence (The "Mental Model") — *Derived Data***

Верхний уровень. Выводы и интерпретации, ради которых строится система.

* **Insight** — найденный паттерн (напр., "Клиент спрашивал про скидку").

* **Score** — оценка вероятности сделки (Win Probability).

* **Recommendation** — предписание менеджеру (Next Best Action).

* **Принцип:** Эти данные производятся нашими пайплайнами на основе *Events* в рамках *Contexts*.

## 4\. Strategic Advantage: The Adaptive Intelligence Moat

Наш технологический ров (Moat) заключается не только в сборе данных, а в **Meta-Learning**.

### **The Adaptive Loop**

Вместо жестких отчетов мы создаем конструктор пайплайнов (Microservice Workflows):

1. **Profiling:** Система определяет профиль клиента на базе фактических данных (тип бизнеса, средний чек, длина цикла, канал продаж, структура коммуникаций).

2. **Pipeline Matching**

   1. Для этого профиля применяется набор проверенных пайплайнов обработки данных: скоры, чеклисты, анализ сделки, поведенческие паттерны менеджеров, контекст коммуникаций.

   2. Каждый пайплайн — это комбинация правил, преобразований и интерпретаций данных, которые исторически показывают эффективность для этого типа бизнеса.

3. **Optimization**

Результаты работы (например Win/Loss, повышение конверсий, улучшение активности менеджеров) позволяют корректировать выбранный пайплайн, заменять шаги, усиливать успешные части и отключать лишнее.

Таким образом, со временем мы накапливаем понимание: какие пайплайны работают лучше для разных сегментов клиентов.

*Clario не просто дает инструмент, а "инсталлирует" лучшие практики продаж, закодированные в софте.*

## 5\. Data Flow & Normalization

Все данные проходят через конвейер:

1. **Ingestion Layer (Raw):** Адаптеры к CRM/Telephony забирают данные "как есть".

2. **Normalization Layer:**

   * Преобразование сырых звонков/писем в `Atomic Events` (Level 1).

   * Привязка событий к `Clario Deal` (Level 2).

3. **Intelligence Layer:**

   * Запуск микросервисов аналитики (RAG, Scoring, Loss Analysis).

   * Генерация `Insights` (Level 3).

4. **Application Layer:** Отображение в Дашбордах, отправка подсказок Ассистентом.

## 6\. Связь с архитектурой (Technical Alignment)

Canonical Model является "контрактом" для микросервисной архитектуры V2:

* **FastAPI Services:** Обмениваются данными только в формате Canonical Model (Pydantic Schemas).

* **Event Bus:** События `CallEvent` или `MessageEvent` триггерят воркеры аналитики.

* **Storage:**

  * *ClickHouse/Postgres* для аналитики (Events).

  * *Qdrant* для RAG (Contexts \+ Insights).

## 7\. Business Model Implications

Event-based архитектура открывает гибкую монетизацию:

* **Usage-Based Pricing:** Мы можем брать деньги за "Проанализированное событие" (Call/Chat minutes), а не только за лицензию.

* **Value-Based Pricing:** Upsell за использование продвинутых пайплайнов (например, "Deep Loss Analysis Pipeline").

## 8\. Next Steps

1. **Define Schema:** Описать Pydantic-схемы для `Atomic Events` и `Clario Deal`.

2. **Map Pipelines:** Определить 2-3 стартовых профиля клиентов и соответствующие им пайплайны аналитики.

3. **Ingestion Refactoring:** Начать переписывание интеграций так, чтобы они сразу маппили данные в Canonical Model.