# Clario Transcription Service - Product Requirements Document

## Обзор продукта

**Название:** Clario Transcription Service (рабочее название)

**Тип:** Микросервис внутри экосистемы Clario

**Назначение:** Автоматическая запись, транскрибация и навигация по видео-звонкам Google Meet для команд продаж с последующей интеграцией в аналитический пайплайн Clario.

**Проблема:** Команды продаж теряют ценную информацию из звонков с клиентами. Менеджеры не могут вернуться к деталям разговора, а руководители не имеют полной картины переговоров команды для качественной аналитики и коучинга.

**Решение:** Автоматизированная система записи Google Meet звонков с транскрибацией, speaker diarization и удобной навигацией для менеджеров и руководителей отделов продаж.

## Цели и задачи

### Бизнес-цели
- Валидировать гипотезу ценности транскрибации звонков для продуктовой аналитики Clario
- Подготовить базу для интеграции транскрипций в существующий аналитический пайплайн
- Создать MVP на 1-3 команды (10-30 пользователей) за 2-3 месяца

### Технические задачи
- Интеграция с Google Meet через Recall.ai
- Автоматическая транскрибация на русском и казахском языках
- Speaker diarization с идентификацией участников встречи
- Навигация по звонкам: список, фильтры, поиск, тайм-коды

### Метрики успеха MVP
- **Ключевая метрика:** % звонков успешно записанных и транскрибированных (целевое значение: >95%)
- Время от окончания звонка до готовой транскрипции (<10 минут)
- Adoption rate среди пилотных команд (>70% активных пользователей)

## Целевая аудитория

### Основные роли

**1. Менеджеры по продажам**
- Проводят звонки с клиентами через Google Meet
- Хотят быстро найти детали из прошлых разговоров
- Видят только свои звонки
- **Pain points:**
  - Невозможно вспомнить все детали после звонка
  - Долго искать информацию в записях вручную
  - Теряются важные упоминания конкурентов, возражений

**2. Руководители отделов продаж**
- Анализируют работу команды
- Проводят коучинг менеджеров
- Видят звонки всей команды
- **Pain points:**
  - Нет полной картины переговоров команды
  - Сложно найти примеры успешных/неуспешных звонков
  - Невозможно масштабировать персональный фидбек

### User Personas

**Persona 1: Максим, менеджер по продажам**
- 28 лет, опыт в продажах 3 года
- Проводит 5-10 звонков в день
- Работает с долгими циклами сделок (3-6 месяцев)
- Проблема: через месяц после звонка не помнит деталей разговора с клиентом

**Persona 2: Анна, Head of Sales**
- 35 лет, управляет командой из 8 менеджеров
- Проводит 1-2 звонка в день, слушает записи команды 3-5 раз в неделю
- Проблема: физически не может прослушать все звонки команды, нужна быстрая навигация к ключевым моментам

## Основные фичи

### MVP (Фаза 1) - 2-3 месяца

#### 1. Интеграция с Google Meet
**Описание:** Автоматическое и ручное добавление звонков для записи

**Функционал:**
- Автоматическое присоединение бота к встречам из Google Calendar через webhooks
- Ручное добавление ссылки на встречу (для ad-hoc звонков без календаря)
- Бот подключается через Recall.ai как обычный участник
- Запись только аудио-дорожки (без видео)

**Зачем:** Минимизировать ручную работу менеджеров, покрыть 100% звонков автоматически

#### 2. Автоматическая транскрибация
**Описание:** Преобразование аудио в текст сразу после завершения звонка

**Функционал:**
- Транскрибация через ElevenLabs (основной) и Yandex Speech Kit (казахский язык)
- Мультиязычная модель с настройкой языка в профиле пользователя
- Speaker diarization: определение кто говорит (Спикер 1, Спикер 2, ...)
- Автоматическая подстановка имён участников на основе данных Google Meet
- Обработка начинается автоматически после завершения встречи

**Зачем:** Сделать звонки доступными для поиска и анализа, разделить реплики по спикерам для понимания диалога менеджер-клиент

#### 3. Навигация и поиск по звонкам
**Описание:** Удобный интерфейс для работы со звонками и транскрипциями

**Функционал:**
- Список всех звонков с метаданными (дата, участники, длительность)
- Фильтры: по дате, участникам, длительности
- Полнотекстовый поиск по транскрипциям
- Тайм-коды: клик на фразу в транскрипции → переход к моменту в аудио
- Проигрыватель аудио с синхронизацией текста

**Зачем:** Быстро находить нужные моменты в звонках без прослушивания записей целиком

#### 4. Разделение доступа (RBAC)
**Описание:** Иерархическая модель доступа к звонкам

**Функционал:**
- **Менеджер:** видит только свои звонки
- **Руководитель:** видит звонки всей команды
- Интеграция с существующей системой auth/tenants/RBAC Clario

**Зачем:** Приватность для менеджеров, контроль для руководителей

#### 5. Хранение и архивация
**Описание:** Lifecycle management для звонков

**Функционал:**
- Hot storage: звонки за последние 90 дней (быстрый доступ)
- Cold storage: старше 90 дней архивируются (доступны по запросу)
- Хранение: аудио + транскрипция + метаданные

**Зачем:** Баланс между доступностью актуальных данных и стоимостью хранения

### Фаза 2 (после валидации MVP)

#### 1. Интеграция с аналитическим пайплайном Clario
- API для экспорта транскрипций в формате для аналитики
- Webhook уведомления о новых транскрипциях
- Метаданные для связи звонков с CRM-сущностями

#### 2. Расширенная аналитика звонков
- Автоматическое извлечение упоминаний конкурентов
- Детекция возражений клиентов
- Sentiment analysis диалога
- Оценка соблюдения скрипта менеджером

#### 3. Экспорт данных
- Экспорт транскрипций (txt, docx, pdf)
- Экспорт аудио
- Bulk экспорт для аналитики (CSV/JSON)

#### 4. Улучшение качества транскрибации
- Отдельные аудио-треки для участников (через Google Meet API для Enterprise)
- Кастомные языковые модели для индустриальной терминологии
- Post-processing транскрипций через LLM для улучшения читаемости

### Будущее развитие (Phase 3+)

- Real-time транскрибация во время звонка
- Live подсказки менеджеру во время звонка
- Интеграция с другими платформами (Zoom, Teams)
- Voice analytics: тон, темп речи, паузы
- Автоматическая генерация follow-up задач из звонков
- Интеграция с knowledge base для ответов на вопросы клиента

## Технический стек

| Компонент | Решение | Альтернативы | Обоснование |
|-----------|---------|--------------|-------------|
| **Backend API** | Go (go-kratos) | Python (FastAPI) | Консистентность с архитектурой Clario, производительность, надёжность |
| **AI Processing** | Python (FastAPI) | Go | Богатая экосистема библиотек для работы с аудио и AI |
| **База данных** | PostgreSQL | MongoDB | Уже используется в Clario, структурированные данные |
| **Транскрибация** | ElevenLabs API + Yandex Speech Kit | OpenAI Whisper, AssemblyAI, Google Speech-to-Text | ElevenLabs — качество, Yandex — поддержка казахского |
| **Speaker Diarization** | Встроенная функция в транскрибацию сервисов | Pyannote.audio (self-hosted) | Использовать возможности API, не усложнять инфраструктуру |
| **Запись Meet** | Recall.ai API | Puppeteer, Google Meet API | Быстрый старт, готовое решение, надёжность |
| **Календарь** | Google Calendar API (webhooks) | Polling | Real-time реакция на события, меньше нагрузки |
| **Хранилище аудио** | S3-compatible storage | Local storage | Масштабируемость, lifecycle policies для архивации |
| **Фронтенд** | React (интеграция в Clario UI) | Vue, Angular | Существующий UI framework Clario |
| **Message Queue** | NATS | RabbitMQ, Kafka | Уже используется в Clario |

### Архитектура микросервиса

```
┌─────────────────────────────────────────────────────────────┐
│                    Clario Platform                          │
│  (Auth, Tenants, RBAC, Frontend)                           │
└────────────────┬────────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────────┐
│           Transcription Service API (Go/Kratos)             │
│  - Управление встречами                                     │
│  - CRUD для звонков и транскрипций                         │
│  - Webhooks от Google Calendar                             │
│  - RBAC integration                                         │
└────┬──────────────────┬─────────────────────────────────────┘
     │                  │
     ▼                  ▼
┌──────────────┐   ┌──────────────────────────────────────┐
│   NATS       │   │  AI Processing Service (Python/FastAPI)│
│   Queue      │   │  - Транскрибация (ElevenLabs/Yandex)  │
└──────────────┘   │  - Speaker diarization                 │
     │             │  - Audio processing                     │
     │             └──────────────────────────────────────────┘
     │                        │
     ▼                        ▼
┌──────────────┐   ┌──────────────────────────────────────┐
│ PostgreSQL   │   │     S3 Storage                       │
│ - Metadata   │   │     - Аудио файлы                    │
│ - Transcripts│   │     - Hot/Cold tiers                 │
└──────────────┘   └──────────────────────────────────────┘
     ▲
     │
     ▼
┌──────────────────────────────────────────────────────────┐
│              External Services                           │
│  - Recall.ai (запись Meet)                              │
│  - Google Calendar API (webhooks)                        │
│  - ElevenLabs API (транскрибация)                       │
│  - Yandex Speech Kit (казахский язык)                   │
└──────────────────────────────────────────────────────────┘
```

## Концептуальная модель данных

### Основные сущности

#### Meeting
- **ID** (UUID)
- **TenantID** (link to Clario tenant)
- **OwnerID** (менеджер-владелец звонка)
- **MeetURL** (Google Meet link)
- **CalendarEventID** (если из календаря)
- **ScheduledAt** (время встречи)
- **Status** (scheduled, recording, processing, completed, failed)
- **Source** (auto/manual)
- **CreatedAt**, **UpdatedAt**

#### Recording
- **ID** (UUID)
- **MeetingID** (FK → Meeting)
- **RecallBotID** (ID бота в Recall.ai)
- **AudioURL** (S3 path)
- **Duration** (секунды)
- **StartedAt**, **EndedAt**
- **Status** (recording, completed, failed)

#### Transcript
- **ID** (UUID)
- **RecordingID** (FK → Recording)
- **Language** (ru/kk)
- **Provider** (elevenlabs/yandex)
- **FullText** (полный текст)
- **Status** (processing, completed, failed)
- **ProcessedAt**

#### TranscriptSegment
- **ID** (UUID)
- **TranscriptID** (FK → Transcript)
- **SpeakerID** (номер спикера)
- **SpeakerName** (имя участника, если определено)
- **Text** (реплика)
- **StartTime** (мс от начала)
- **EndTime** (мс от начала)
- **Confidence** (уверенность распознавания)

#### Participant
- **ID** (UUID)
- **MeetingID** (FK → Meeting)
- **UserID** (если известен пользователь Clario)
- **Email** (из Google Meet)
- **Name**
- **Role** (owner/participant)

### Ключевые связи
- **Meeting** → **Recording** (1:1) - одна встреча = одна запись
- **Recording** → **Transcript** (1:1) - одна запись = одна транскрипция
- **Transcript** → **TranscriptSegment** (1:N) - транскрипция разбита на реплики
- **Meeting** → **Participant** (1:N) - во встрече много участников

## UI/UX Принципы

### Дизайн
- **Design System:** Существующий UI framework Clario (React + Tailwind/UI библиотека)
- **Принцип:** Seamless интеграция в текущий интерфейс Clario
- **Новый раздел:** "Звонки" или "Встречи" в главном меню

### Ключевые экраны

#### 1. Список звонков
- Таблица с колонками: Дата, Название встречи, Участники, Длительность, Статус
- Фильтры: дата (диапазон), участники (autocomplete), статус
- Для руководителей: фильтр по менеджеру команды
- Сортировка по всем колонкам
- Индикаторы статуса: ⏺ запись, ⚙️ обработка, ✅ готово, ❌ ошибка

#### 2. Детальный просмотр звонка
- **Хедер:** Название встречи, участники, дата, длительность
- **Левая панель:** Аудио-плеер с waveform
- **Правая панель:** Транскрипция
  - Реплики разделены по спикерам (имя/иконка)
  - Тайм-коды на каждой реплике
  - Highlight текущей реплики при проигрывании
  - Клик на реплику → переход к моменту в аудио
- **Поиск:** Строка поиска → подсветка совпадений в транскрипции

#### 3. Настройки
- Подключение Google Calendar (OAuth)
- Выбор языка транскрибации (русский/казахский/авто)
- Настройки уведомлений (когда транскрипция готова)

### Референсы UX
- **Fireflies.ai** - навигация по транскрипции, синхронизация с аудио
- **Otter.ai** - speaker labels, поиск по тексту
- **Clario существующий UI** - визуальный стиль, компоненты

## Аутентификация и безопасность

**Аутентификация:** Интеграция с существующей auth системой Clario (оставлена за рамками PRD)

**RBAC:**
- **Менеджер (Sales Rep):** read own meetings, create meetings
- **Руководитель (Sales Manager):** read team meetings, read own meetings

**Защита данных:**
- Звонки привязаны к tenant и доступны только пользователям этого tenant
- Аудио файлы в S3 с server-side encryption
- HTTPS для всех API запросов
- Webhook endpoints защищены подписями (HMAC)

**Приватность:**
- Согласие участников на запись (disclaimer в начале звонка через бота)
- Возможность удалить звонок (для владельца/руководителя)
- Архивные звонки не индексируются для поиска (cold storage)

## Этапы разработки

### Этап 1: Foundation (недели 1-3)
- [ ] Настройка микросервиса Go (go-kratos boilerplate)
- [ ] Модель данных и миграции PostgreSQL
- [ ] Базовый CRUD API для Meeting/Recording/Transcript
- [ ] Интеграция с Clario auth/RBAC
- [ ] Python микросервис для AI processing (FastAPI boilerplate)
- [ ] NATS integration между сервисами

### Этап 2: Интеграция с Google Meet (недели 4-5)
- [ ] Google Calendar API: OAuth flow, webhook subscriptions
- [ ] Recall.ai интеграция: создание бота, управление записью
- [ ] Автоматический workflow: календарь → запись → сохранение аудио в S3

### Этап 3: Транскрибация (недели 6-7)
- [ ] ElevenLabs API интеграция
- [ ] Yandex Speech Kit интеграция
- [ ] Speaker diarization pipeline
- [ ] Сохранение транскрипций в БД (segments с тайм-кодами)
- [ ] Автоматический триггер транскрибации после завершения записи

### Этап 4: Frontend UI (недели 8-10)
- [ ] Список звонков с фильтрами
- [ ] Детальный просмотр: аудио-плеер + транскрипция
- [ ] Синхронизация аудио и текста (highlight активной реплики)
- [ ] Полнотекстовый поиск по транскрипциям
- [ ] Настройки подключения календаря

### Этап 5: Архивация и оптимизация (недели 11-12)
- [ ] Lifecycle policy для S3 (90 дней → cold storage)
- [ ] Background job для архивации старых звонков
- [ ] Мониторинг и алерты (Prometheus/Grafana)
- [ ] Оптимизация производительности поиска (full-text indexes)

### Этап 6: Тестирование и пилот (недели 12-13)
- [ ] End-to-end тестирование всего flow
- [ ] Нагрузочное тестирование (10-30 пользователей, 50-100 звонков/день)
- [ ] Деплой на пилотные команды (1-3 команды)
- [ ] Сбор фидбека и метрик

## Потенциальные вызовы и решения

| Вызов | Влияние | Предложенное решение |
|-------|---------|---------------------|
| **Низкая точность speaker diarization в групповых звонках** | Высокое - ключевая фича может не работать корректно | 1) Начать с тестирования на реальных звонках в пилоте<br>2) Fallback: показывать "Спикер 1/2/3" без имён если точность низкая<br>3) Phase 2: использовать отдельные аудио-треки через Google Meet Enterprise API |
| **Качество транскрибации казахского языка** | Среднее - зависит от % казахских звонков | 1) A/B тестирование Yandex Speech Kit vs другие провайдеры<br>2) Сбор метрик WER (Word Error Rate) на пилоте<br>3) Возможность ручной корректировки транскрипций |
| **Стоимость обработки большого количества звонков** | Среднее - влияет на unit-экономику | 1) Оптимизировать: только аудио, не видео<br>2) Сжатие аудио перед отправкой на транскрибацию<br>3) Мониторинг стоимости на пилоте, расчёт ROI |
| **Надёжность Recall.ai** | Высокое - зависимость от внешнего сервиса | 1) SLA мониторинг Recall.ai<br>2) Retry логика при неудачах подключения<br>3) Возможность ручной загрузки записи если бот не подключился<br>4) Phase 2: рассмотреть self-hosted решение (Puppeteer) |
| **Скорость обработки транскрипций** | Среднее - влияет на UX | 1) Целевое SLA: <10 минут после завершения звонка<br>2) Параллельная обработка через NATS queue<br>3) Webhook уведомления когда готово (не заставлять ждать) |
| **Синхронизация имён участников** | Низкое - nice-to-have | 1) MVP: показывать email из Google Meet<br>2) Попытка автоматического matching с Clario users по email<br>3) Ручное редактирование имён спикеров (Phase 2) |

## Зависимости и риски

### Внешние зависимости
- **Recall.ai API:** критическая зависимость для записи
- **ElevenLabs API:** критическая для транскрибации
- **Yandex Speech Kit:** критическая для казахского
- **Google Calendar API:** критическая для автоматизации

### Технические риски
- Speaker diarization может не работать стабильно → нужен план Б (показывать без имён)
- Recall.ai может иметь downtime → retry логика + ручная загрузка
- Транскрибация казахского может быть низкого качества → мониторинг на пилоте

### Организационные риски
- Adoption: менеджеры могут не использовать если сложно → упростить onboarding
- Privacy concerns: менеджеры могут не хотеть записи → прозрачность, контроль удаления

## Будущие возможности

### Интеграция с аналитикой (Phase 2)
- Webhook API для экспорта транскрипций в аналитический пайплайн Clario
- Метаданные для связи звонков с CRM-объектами (лиды, сделки)
- Real-time streaming транскрипций для live аналитики

### AI-аналитика звонков (Phase 2-3)
- Автоматическая категоризация звонков (demo, negotiation, objection handling)
- Sentiment analysis: настроение клиента на разных этапах звонка
- Compliance checking: соблюдение скриптов, упоминание обязательных пунктов
- Автоматическая генерация summary и action items

### Расширение платформ (Phase 3)
- Zoom интеграция
- Microsoft Teams интеграция
- Телефонные звонки (через VoIP интеграцию)

### Real-time возможности (Phase 3)
- Live транскрипция во время звонка
- Real-time подсказки менеджеру (battlecards, ответы на возражения)
- Live alerts руководителю при критических словах (cancellation, competitor)

## Критерии успеха MVP

### Продуктовые метрики
- ✅ **Success rate записи:** >95% звонков успешно записаны и транскрибированы
- ✅ **Processing time:** <10 минут от окончания звонка до готовой транскрипции
- ✅ **Adoption rate:** >70% пользователей пилотных команд активно используют (проверяют транскрипции)
- ✅ **Search usage:** >50% пользователей используют поиск по транскрипциям

### Технические метрики
- Uptime: >99% доступности сервиса
- Speaker diarization accuracy: >80% корректно определённых спикеров
- Transcription quality (WER): <10% для русского, <15% для казахского

### Бизнес-валидация
- ✅ Позитивный фидбек от пилотных команд (NPS >7)
- ✅ Хотя бы 1 кейс где транскрипция помогла закрыть сделку или решить проблему
- ✅ Готовность минимум 1 пилотной команды продолжить использование после MVP

---

## Приложения

### Глоссарий
- **Speaker diarization** - процесс определения "кто и когда говорит" в аудио-записи
- **WER (Word Error Rate)** - метрика качества транскрибации, % ошибочно распознанных слов
- **Hot storage** - быстрое хранилище для актуальных данных
- **Cold storage** - архивное хранилище для старых данных (медленнее, дешевле)
- **Recall.ai** - сервис для автоматической записи видео-встреч через бота

### Референсы
- **Fireflies.ai** - основной функциональный референс
- **Otter.ai** - UX для навигации по транскрипциям
- **Gong.io** - enterprise-уровень аналитики звонков (Phase 3 vision)

---

*Создано с помощью /prd*
*Дата: 2026-02-06*
*Версия: 1.0 MVP*
