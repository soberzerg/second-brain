# Интеллектуальный ассистент СПК «Түркістан» — Masterplan

## Обзор приложения

Корпоративная ИИ-платформа для АО «СПК «Түркістан». Два модуля: внутренний ассистент для сотрудников (RAG-поиск по корпоративным документам с разграничением доступа) и публичный чат-бот на сайте spkturkistan.kz для консультирования граждан и партнёров.

Решает проблему: сотрудники тратят часы на поиск информации в архивах, опираются на устаревшие документы, не имеют единой точки доступа к корпоративным знаниям. Внешние пользователи не могут быстро получить ответы по деятельности организации.

---

## Цели и задачи

- Сократить время поиска информации в корпоративных документах с часов до секунд
- Обеспечить единую точку доступа к актуальным версиям всех документов
- Разграничить доступ к документам по подразделениям и ролям
- Снизить нагрузку на сотрудников от типовых обращений через публичный чат-бот
- Обеспечить полный аудит использования системы для руководства
- Предложить решение «похожее на Sky (Самрук-Казына)» — закрытый ИИ-ассистент для квазигос корпорации

---

## Целевая аудитория

**Основной сегмент:** Сотрудники АО «СПК «Түркістан» (50-200 человек)

**Вторичный сегмент:** Внешние пользователи — граждане, партнёры, инвесторы через сайт spkturkistan.kz

**User Personas:**

| Персона | Потребность | Типичный запрос |
|---------|------------|----------------|
| **Руководство** | Стратегические сводки, история решений | «Какие изменения вносились по стабилизационному фонду за 2020–2024 гг.?» |
| **Юридическая служба** | Поиск НПА, сравнение редакций | «На каких документах основан текущий порядок субсидирования?» |
| **Сотрудники подразделений** | Регламенты, инструкции, шаблоны | «Какой порядок согласования командировок?» |
| **Внешние пользователи** | Консультация по деятельности | «Какие инвестиционные проекты реализуются в Туркестанской области?» |

---

## Основные фичи

### MVP (Фаза 1)

1. **Корпоративный RAG-ассистент** — семантический поиск по документам с ответами и ссылками на источники (документ, раздел, страница). Базируется на существующем RAG-пайплайне AGIents.pro
2. **Разграничение доступа по подразделениям** — фильтрация документов при RAG-поиске на основе принадлежности пользователя к подразделению. Доработка существующего базового RBAC AGIents
3. **OCR-пайплайн** — автоматическое распознавание текста из сканированных PDF/изображений при загрузке в базу знаний. Новый модуль
4. **Публичный чат-бот (JS-виджет)** — встраиваемый виджет для сайта spkturkistan.kz, работающий с открытой базой знаний. Казахский + русский языки. **Конкурентное преимущество — конкуренты этого не предлагают**
5. **Локальная авторизация** — собственная система учётных записей с ролями (админ, руководство, юристы, сотрудники подразделений)
6. **Журнал аудита** — логирование всех запросов, ответов, источников, пользователей
7. **Сводки и резюме** — автоматическая подготовка кратких резюме длинных документов

### Фаза 2 (после валидации)

1. **Версионирование и сравнение документов** — хранение версий документов с возможностью показать разницу между редакциями через LLM-анализ
2. **Аналитический дашборд** — визуализация метрик: популярные документы, частота запросов, пробелы в базе знаний (неотвеченные вопросы), качество ответов
3. **Генерация документов** — черновики справок, служебных записок, ответов на запросы на основе шаблонов и базы знаний
4. **Интеграция с внешними порталами РК** — подключение к НПА и государственным реестрам по утверждённому whitelist

### Будущее развитие

- Интеграция с ЭДО/СЭД заказчика (конкретная система определяется на этапе аналитики)
- Специализированные ассистенты для отдельных подразделений (юристы, финансисты, проектный офис)
- Автоматическая подготовка регулярных отчётов
- Полный закрытый контур с self-hosted LLM
- Опциональная интеграция с ALM-LLM (казахстанская модель) для перевода на казахский

---

## Технический стек

| Компонент | Решение | Альтернативы | Обоснование |
|-----------|---------|-------------|-------------|
| Платформа | AGIents.pro | — | Существующая проверенная платформа, сокращает сроки с 5-6 до 2-3 месяцев |
| Backend | Go (go-kratos, go-ent) | — | Текущий стек AGIents |
| БД | PostgreSQL | — | Текущий стек AGIents |
| Messaging | NATS | — | Текущий стек AGIents |
| LLM (cloud) | OpenAI GPT-4o | Gemini, Claude API | GPT-4o — хорошая поддержка казахского |
| LLM (self-hosted) | Llama 3.1 70B / Mistral Large | Qwen 2.5 72B | Опция для закрытого контура |
| LLM (казахский) | ALM-LLM (опционально) | — | Казахстанская модель, для «галочки» + реальная польза с казахским |
| Embeddings | OpenAI text-embedding-3-large | — | Текущий пайплайн AGIents |
| Vector Store | pgvector (PostgreSQL) | Qdrant, Milvus | Единая БД, меньше инфраструктуры |
| OCR | Tesseract + предобработка | PaddleOCR | Tesseract — self-hosted, без зависимости от cloud |
| Frontend (корпоративный) | React + Vite + Tailwind | — | Текущий стек AGIents |
| Frontend (виджет) | Vanilla JS / Preact | — | Минимальный бандл для встраивания на сторонний сайт |
| Инфраструктура | VDS / оборудование заказчика | Казахстанский хостинг | Три варианта: on-premise, аренда, гибрид |

### Архитектура моделей (зоопарк)

Рекомендуется использовать несколько моделей под разные задачи:

| Модель | Назначение | Формат |
|--------|-----------|--------|
| **Сильная** (GPT-4o / Claude) | Сложные аналитические запросы, сравнение документов, генерация | Cloud API или self-hosted аналог |
| **Быстрая** (GPT-4o-mini) | Простые вопросы, навигация, рутинные запросы | Cloud API |
| **Мини** (Llama 3.1 8B) | Классификация запросов, роутинг, определение языка | Self-hosted, быстрая |
| **ALM-LLM** (опционально) | Перевод на казахский, специфичные казахские запросы | Зависит от провайдера |

---

## Концептуальная модель данных

### Основные сущности

- **Organization** — АО «СПК «Түркістан», конфигурация, настройки
- **Department** — подразделение (юридическая служба, проектный офис и т.д.)
- **User** — сотрудник, привязан к Department, имеет Role
- **Role** — роль доступа (admin, executive, lawyer, department_member)
- **Document** — загруженный документ (файл, метаданные, уровень доступа, дата, источник)
- **DocumentVersion** — версия документа для сравнения редакций (Фаза 2)
- **DocumentChunk** — чанк документа с эмбеддингом для RAG-поиска
- **AccessPolicy** — правила: какие роли/подразделения видят какие документы
- **Conversation** — сессия диалога сотрудника с ассистентом
- **Message** — сообщение в диалоге (вопрос/ответ + ссылки на источники)
- **AuditLog** — запись аудита (пользователь, запрос, ответ, источники, timestamp)
- **PublicConversation** — сессия диалога внешнего пользователя через виджет

### Ключевые связи

- User → Department: many-to-one
- User → Role: many-to-one
- Document → Department: many-to-many (документ доступен нескольким подразделениям)
- Document → DocumentChunk: one-to-many
- Document → DocumentVersion: one-to-many (Фаза 2)
- AccessPolicy → Role + Department + Document
- Conversation → User → Message
- AuditLog → User + Message

---

## Архитектура RAG-пайплайна

### Загрузка документов (Ingestion)

```
Документ (PDF/Word/Excel/PowerPoint/скан/HTML)
  → Определение типа
  → OCR (если скан) → Tesseract + предобработка (денойзинг, выравнивание)
  → Парсинг → извлечение текста, структуры, метаданных
  → Чанкинг → разбивка на семантические чанки
  → Эмбеддинг → OpenAI text-embedding-3-large
  → Сохранение → PostgreSQL (pgvector) + метаданные + access_policy + department_tags
```

### Поиск и ответ (Retrieval)

```
Запрос пользователя
  → Определение языка (kz/ru) → мини-модель
  → Классификация запроса → роутинг на сильную/быструю модель
  → Эмбеддинг запроса
  → Векторный поиск по pgvector С ФИЛЬТРАЦИЕЙ по access_policy пользователя
  → Re-ranking релевантных чанков
  → Формирование контекста + системный промпт
  → LLM генерация ответа с указанием источников (документ, дата, раздел, страница)
  → Логирование в AuditLog
```

### Фильтрация доступа при поиске (ключевая доработка)

Текущий RBAC AGIents дополняется:
- Тегирование документов по подразделениям при загрузке
- Metadata-фильтр в векторном поиске: `WHERE department_id IN (user.department_id, 'common')`
- Уровни доступа:
  - `public` — доступно всем сотрудникам + внешний виджет
  - `internal` — доступно всем сотрудникам
  - `executive` — только руководство
  - `department` — сотрудники конкретного подразделения
  - `legal` — юридическая служба

---

## UI/UX Принципы

- **Desktop-first** — основной интерфейс для работы с ПК
- **Минимальный порог входа** — чат-интерфейс, знакомый всем
- **Ответы с источниками** — каждый ответ содержит кликабельные ссылки на документы
- **Двуязычность** — интерфейс и ответы на казахском и русском, автоопределение
- **Референсы:** Sky (Самрук-Казына) — целевой образ для заказчика, ChatGPT (чат-интерфейс), Intercom (виджет)

---

## Аутентификация и безопасность

- **Метод аутентификации:** Локальные учётные записи (email + пароль), управление администратором
- **Роли:**
  - `admin` — полный доступ, управление пользователями и документами
  - `executive` — доступ ко всем документам, аналитический дашборд
  - `lawyer` — юридические документы + общая база
  - `department_member` — документы своего подразделения + общая база
- **Публичный модуль:** Без аутентификации, только документы с уровнем `public`
- **Журнал действий:** Полное логирование всех запросов и ответов
- **Политика ответов:** Ответы только на основе загруженных документов, запрет на галлюцинации
- **HTTPS:** Обязательно
- **Rate limiting:** Для публичного виджета
- **Данные:** Не покидают пределы Казахстана (требование квазигос)

---

## Аудит и аналитика

### MVP — Базовый аудит-лог

- Логирование: кто, когда, что спросил, какой ответ получил, какие источники
- Просмотр логов администратором
- Экспорт в CSV/Excel

### Фаза 2 — Аналитический дашборд

- Количество запросов по дням/неделям/месяцам
- Топ-запросы по подразделениям
- Популярные документы (чаще всего цитируются)
- Неотвеченные вопросы / низкокачественные ответы (пробелы в базе знаний)
- Активность по пользователям
- Статистика публичного виджета
- Экспорт отчётов (PDF, Excel)

---

## Варианты деплоя

### Инфраструктура

| Вариант | Описание | Для кого |
|---------|----------|----------|
| **On-premise** | Сервер с GPU в дата-центре заказчика | Максимальный контроль и безопасность |
| **Аренда в КЗ** | Выделенный сервер у казахстанского хостера + VPN | Быстрый старт без капитальных затрат |
| **Гибридный** | Веб-сервер у заказчика, GPU-сервер в аренде | Баланс безопасности и стоимости |

### Рекомендуемые характеристики сервера

- CPU: 16 ядер / 32 потока (Xeon / EPYC)
- RAM: 128 GB ECC
- Диски: 2x1.92 TB NVMe (RAID1)
- GPU: NVIDIA A100 40GB или L40S (для self-hosted LLM)
- Сеть: 1 Gbps

### Варианты LLM

| Вариант | Плюсы | Минусы | Рекомендация |
|---------|-------|--------|-------------|
| **Cloud API (GPT-4o)** | Лучшее качество, казахский, быстрый старт | Данные уходят за периметр | **MVP — для быстрого запуска** |
| **Self-hosted** | Полный закрытый контур | GPU-инфра, качество казахского ниже | Для жёстких требований ИБ |
| **Гибрид** | Баланс: self-hosted для рутины, cloud для сложного | Сложнее в эксплуатации | Оптимальный вариант |

**Рекомендация:** Начать с Cloud API, параллельно тестировать self-hosted на казахском. Переход на self-hosted при требовании полного закрытого контура.

---

## Этапы разработки

### Этап 1: Аналитика и согласование (4 недели)

- [ ] Аудит документов заказчика: объём, форматы, уровни конфиденциальности
- [ ] Маппинг подразделений и ролей доступа
- [ ] Определение набора тестовых вопросов для валидации качества
- [ ] Согласование варианта размещения инфраструктуры
- [ ] Выбор 1-2 подразделений для пилота
- [ ] Утверждение ТЗ

**Результат:** Согласованное ТЗ, план пилота, матрица доступа

### Этап 2: Подготовка данных и доработки платформы (4 недели)

- [ ] Доработка RBAC: фильтрация документов по подразделениям в RAG-поиске
- [ ] Разработка OCR-пайплайна (Tesseract + предобработка)
- [ ] Разработка JS-виджета для публичного модуля
- [ ] Сбор и систематизация документов заказчика
- [ ] Загрузка документов, тегирование по подразделениям
- [ ] Проверка качества OCR на сканированных документах

**Результат:** Наполненная база знаний, готовые доработки

### Этап 3: Настройка и пилот (4-8 недель)

- [ ] Развёртывание на инфраструктуре заказчика / аренде
- [ ] Настройка ролей и учётных записей
- [ ] Тонкая настройка промптов под специфику организации (казахский + русский)
- [ ] Пилотный запуск в 1-2 подразделениях
- [ ] Сбор обратной связи, замер качества ответов
- [ ] Корректировки по результатам пилота
- [ ] Запуск базового аудит-лога

**Результат:** Система прошла пилотное тестирование

### Этап 4: Запуск и обучение (4 недели)

- [ ] Ввод в эксплуатацию для всех подразделений
- [ ] Запуск публичного виджета на spkturkistan.kz
- [ ] Обучение пользователей и администраторов
- [ ] Передача документации
- [ ] Настройка мониторинга и алертов

**Результат:** Система в промышленной эксплуатации

### Этап 5: Расширение (после запуска, по договору)

- [ ] Аналитический дашборд для руководства
- [ ] Версионирование и сравнение документов
- [ ] Генерация черновиков документов
- [ ] Интеграция с порталами НПА РК
- [ ] Интеграция с ЭДО/СЭД (если применимо)
- [ ] Тестирование self-hosted LLM / ALM-LLM

**Общий срок MVP: 4-5 месяцев (реально 2-3 за счёт AGIents.pro)**

---

## Потенциальные вызовы и решения

| Вызов | Влияние | Предложенное решение |
|-------|---------|---------------------|
| Качество казахского языка у LLM | Некорректные ответы на казахском | Тестирование на пилоте, фоллбэк на русский, опциональная ALM-LLM |
| Низкое качество сканов (OCR) | Ошибки в тексте → плохие ответы | Предобработка (денойзинг, выравнивание), ручная валидация критичных документов |
| Разграничение доступа при RAG | Утечка информации через контекст LLM | Фильтрация на уровне векторного поиска (до LLM), аудит |
| Закрытый контур vs качество LLM | Self-hosted модели уступают GPT-4o | Начать с cloud, тестировать self-hosted параллельно, дать выбор |
| Объём документов растёт | Деградация скорости поиска | Индексация pgvector с HNSW, партиционирование |
| Сопротивление пользователей | Низкое adoption | Пилот в лояльных подразделениях, обучение, демонстрация ценности |
| Конкуренция (Digital Studio Team) | Могут забрать проект | Наши преимущества: цена (в 3x дешевле), скорость (2-3 мес), готовая платформа, внешний бот |
| Open-source модели устаревают | Нужен постоянный апгрейд | Архитектура с абстракцией LLM — легко заменить модель |

---

## Будущие возможности

- **Self-hosted LLM** — полный закрытый контур при появлении качественных мультиязычных моделей
- **ALM-LLM интеграция** — казахстанская модель для максимальной поддержки казахского языка
- **Интеграция с ЭДО/СЭД** — автообновление базы знаний при новых документах
- **Специализированные агенты** — отдельные ассистенты для юристов, финансистов, проектного офиса
- **Автоматические отчёты** — сводки по заданным параметрам для руководства
- **Тиражирование** — адаптация решения для других СПК Казахстана и квазигос структур

---

## Коммерческие условия

Детали в коммерческом предложении: [SPK-Turkestan-PRD.md](SPK-Turkestan-PRD.md)

**Ключевые цифры:**
- Стоимость разработки и внедрения: 50 000 000 ₸
- Инфраструктура: рассчитывается отдельно
- Оплата поэтапно: 30% / 40% / 30%
- Сопровождение: по договору

---

*Создано с помощью /prd*
*Clario, февраль 2026*
